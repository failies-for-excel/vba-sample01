Option Explicit

Sub 記事作成()
    Dim Number As Integer
    Dim sh As Worksheet
    
    Number = 1
    
    For Each sh In Worksheets
        sh.Select
        If sh.Name = "Main" Then GoTo L1
        If sh.Name = "database" Then GoTo L1
        If sh.Name = "single" Then GoTo L1
        If sh.Name = "many" Then GoTo L1
        If sh.Name = "記事" Then GoTo L1
        
        Call Find
        Worksheets("Main").Activate
        Call ReplaceSamp1
        Worksheets("Main").Activate
    
        Call hennkou
        Worksheets("Main").Activate
        Call BendaSplit
        Worksheets("Main").Activate
        Call BendaSplit
        Worksheets("Main").Activate
        Call ProductSplit
        Worksheets("Main").Activate
    
        Call ベンダ情報比較1
        Worksheets("Main").Activate
        Call ベンダ情報比較2
        Worksheets("Main").Activate
    
        
    
        Call 文章校正1(Number)
        Worksheets("Main").Activate
        Call 文章校正2(Number)
        Worksheets("Main").Activate
        Call prog2
        Worksheets("Main").Activate
    
    
        Call output
        Worksheets("Main").Activate
       
        Call a
        Worksheets("Main").Activate
        Number = Number + 1
        Application.DisplayAlerts = False
        sh.Delete
        Application.DisplayAlerts = True
L1:
    Next
    Call clear
    
End Sub

Sub Find() '
    Dim sh As Worksheet
    Dim i As Integer
    Dim n As Integer
    Dim R As Integer
    Dim K As Long
    Dim Value1
    Value1 = "脆弱性"
    
    Dim a, b, c, d, e, f, g, h, j, l
    Dim aa, bb, cc, dd, ee, ff, gg, hh, jj, ll
    a = ActiveWorkbook.Worksheets("Main").Cells(2, "H")
    b = ActiveWorkbook.Worksheets("Main").Cells(3, "H")
    c = ActiveWorkbook.Worksheets("Main").Cells(4, "H")
    d = ActiveWorkbook.Worksheets("Main").Cells(5, "H")
    e = ActiveWorkbook.Worksheets("Main").Cells(6, "H")
    f = ActiveWorkbook.Worksheets("Main").Cells(7, "H")
    g = ActiveWorkbook.Worksheets("Main").Cells(8, "H")
    h = ActiveWorkbook.Worksheets("Main").Cells(9, "H")
    j = ActiveWorkbook.Worksheets("Main").Cells(10, "H")
    
    i = 2
    
    For Each sh In Worksheets
        sh.Select
        K = 1
        If sh.Name = "Main" Then GoTo L1
        If sh.Name = "database" Then GoTo L1
        If sh.Name = "single" Then GoTo L1
        If sh.Name = "many" Then GoTo L1
        If sh.Name = "記事" Then GoTo L1
        
        Set aa = sh.Cells.Find(What:=a, LookAt:=xlWhole)
        Set bb = sh.Cells.Find(What:=b, LookAt:=xlPart)
        Set cc = sh.Cells.Find(What:=c, LookAt:=xlPart)
        Set dd = sh.Cells.Find(What:=d, LookAt:=xlPart)
        Set ee = sh.Cells.Find(What:=e, LookAt:=xlPart)
        Set ff = sh.Cells.Find(What:=f, LookAt:=xlWhole)
        Set gg = sh.Cells.Find(What:=g, LookAt:=xlPart)
        Set hh = sh.Cells.Find(What:=h, LookAt:=xlPart)
        Set jj = sh.Cells.Find(What:=j, LookAt:=xlWhole)
        Set ll = sh.Cells.Find(What:=Value1, LookAt:=xlPart)
        
        If aa <> "" Then
            ActiveWorkbook.Worksheets("Main").Cells(i, "G").Value = ee
            ActiveWorkbook.Worksheets("Main").Cells(i, "J") = Value1
            ActiveWorkbook.Worksheets("Main").Cells(i, "F") = dd
            ActiveWorkbook.Worksheets("Main").Cells(i, "E") = cc

            
            n = hh.Row - jj.Row - 1
            For R = 1 To n
                ActiveWorkbook.Worksheets("Main").Cells(i, "D").Value = sh.Cells(jj.Row + K, "A")
                i = i + 1
                K = K + 1
            Next R
            K = 1
            R = 1
            i = 2
            
            n = bb.Row - aa.Row - 1
            For R = 1 To n
                ActiveWorkbook.Worksheets("Main").Cells(i, "A").Value = sh.Cells(aa.Row + K, "A")
                i = i + 1
                K = K + 1
            Next R
            K = 1
            R = 1
            i = 2
            
            n = gg.Row - ff.Row - 1
            For R = 1 To n
                ActiveWorkbook.Worksheets("Main").Cells(i, "C").Value = sh.Cells(ff.Row + K, "A")
                i = i + 1
                K = K + 1
            Next R
            K = 1
            R = 1
            i = 2
            
            'i = i + 1
            GoTo L2
        End If
L1:
    Next sh
L2:
End Sub


Sub ReplaceSamp1()

 Range("J1:J6").Select
 With Selection
   .Replace What:="おける", Replacement:="", LookAt:=xlPart
 End With

End Sub

Sub hennkou()

    Range("A1:A6").Select
    With Selection
     .Replace What:=vbTab, Replacement:="", LookAt:=xlPart
     .Replace What:=vbLf, Replacement:="・", LookAt:=xlPart
     .Replace What:="・・", Replacement:="・", LookAt:=xlPart
     .Replace What:="・", Replacement:=vbLf + "・", LookAt:=xlPart
    End With
    
    Range("C1:C6").Select
    With Selection
     .Replace What:=vbTab, Replacement:="", LookAt:=xlPart
     .Replace What:=vbLf, Replacement:="・", LookAt:=xlPart
     .Replace What:="・・", Replacement:="・", LookAt:=xlPart
     .Replace What:="・", Replacement:=vbLf + "・", LookAt:=xlPart
    End With
    
End Sub


Sub EmptyCellDelete()
    Dim rngSearch, VarSearch
    Dim rngEnd, varEnd
    Dim sh As Worksheet
    Dim i As Integer
    Dim y As Integer
    For Each sh In Worksheets
        sh.Select
        For y = 200 To 1 Step -1
            If Application.WorksheetFunction.CountA(Rows(y)) = 0 Then
            sh.Rows(y).Delete
            End If
        Next y
L1:
    Next
    
End Sub

Sub EmptyCellDelete1()
    Dim rngSearch, VarSearch
    Dim rngEnd, varEnd
    Dim sh As Worksheet
    Dim i As Integer
    Dim y As Integer
    For Each sh In Worksheets
        sh.Select
        For y = 200 To 1 Step -1
            If Application.WorksheetFunction.CountA(Columns(y)) = 0 Then
            sh.Columns(y).Delete
            End If
        Next y
L1:
    Next
    
End Sub



Sub BendaSplit()
    Dim i As Long
    Dim a As Long
    Dim b As Long
    Dim c
    b = 2
    Dim tmp As Variant
    a = 0
    For i = 2 To 11
        tmp = Split(Cells(i, "A"), vbLf)
        For Each c In tmp
            
            Cells(b, "K") = tmp(a)
            a = a + 1
            b = b + 1
        Next c
    Next i
End Sub

Sub ProductSplit()
    Dim i As Long
    Dim a As Long
    Dim b As Long
    Dim c
    b = 2
    Dim tmp As Variant
    a = 0
    For i = 2 To 11
        tmp = Split(Cells(i, "C"), vbLf)
        For Each c In tmp
            
            Cells(b, "L") = tmp(a)
            a = a + 1
            b = b + 1
        Next c
    Next i
End Sub

Sub ベンダ情報比較1() 'ベンダ情報すりあわせ
    Dim benda_data As Long
    Dim database_data As Long
    
    Range("K1:K15").Select
    With Selection
     .Replace What:="・", Replacement:="", LookAt:=xlPart
    End With
    
    For benda_data = 2 To 10
        For database_data = 1 To 10
        
             If ActiveWorkbook.Worksheets("Main").Range("K" & benda_data).Value = "" Then
                GoTo L2
            End If
            
            If ActiveWorkbook.Worksheets("Main").Range("K" & benda_data).Value <> ActiveWorkbook.Worksheets("database").Range("A" & database_data).Value Then
                GoTo L1
            End If
            
            If ActiveWorkbook.Worksheets("Main").Range("K" & benda_data).Value = ActiveWorkbook.Worksheets("database").Range("A" & database_data).Value Then
                 ActiveWorkbook.Worksheets("Main").Range("K" & benda_data).Value = "!" & "　" & ActiveWorkbook.Worksheets("Main").Range("K" & benda_data).Value
                GoTo L2
            End If
L1:
        Next database_data
        ActiveWorkbook.Worksheets("Main").Range("K" & benda_data).Value = "・" & ActiveWorkbook.Worksheets("Main").Range("K" & benda_data).Value
L2:
    Next benda_data
End Sub

Sub ベンダ情報比較2() 'ベンダ情報すりあわせ
    Dim benda_data As Long
    Dim database_data As Long
    Range("L1:L15").Select
    With Selection
     .Replace What:="・", Replacement:="", LookAt:=xlPart
    End With
    For benda_data = 2 To 10
        
        For database_data = 1 To 10
        
             If ActiveWorkbook.Worksheets("Main").Range("L" & benda_data).Value = "" Then
                GoTo L2
            End If
            
            If ActiveWorkbook.Worksheets("Main").Range("L" & benda_data).Value <> ActiveWorkbook.Worksheets("database").Range("A" & database_data).Value Then
                GoTo L1
            End If
            
            If ActiveWorkbook.Worksheets("Main").Range("L" & benda_data).Value = ActiveWorkbook.Worksheets("database").Range("A" & database_data).Value Then
                 ActiveWorkbook.Worksheets("Main").Range("L" & benda_data).Value = "!" & "　" & ActiveWorkbook.Worksheets("Main").Range("L" & benda_data).Value
                GoTo L2
            End If
L1:
        Next database_data
        ActiveWorkbook.Worksheets("Main").Range("L" & benda_data).Value = "・" & ActiveWorkbook.Worksheets("Main").Range("L" & benda_data).Value
L2:
    Next benda_data
End Sub

Sub clear()
    Worksheets("記事").Cells(2, "B").Value = ""
    Worksheets("記事").Cells(4, "B").Value = ""
    Worksheets("記事").Cells(6, "B").Value = ""
    Worksheets("記事").Cells(8, "B").Value = ""
    Worksheets("記事").Cells(10, "B").Value = ""
    Worksheets("記事").Cells(12, "B").Value = ""
End Sub


Sub a()
    Worksheets("Main").Range("G31,A2:A31,C2:G31,J2:J31").Select
    ActiveWindow.ScrollColumn = 2
    Worksheets("Main").Range("G31,A2:A31,C2:G31,J2:L31").Select
    Worksheets("Main").Range("J2").Activate
    Selection.ClearContents
End Sub



Sub output() 'テキストに出力
    
    Dim R As Integer
    R = 1
    Worksheets("記事").Activate
    
    Worksheets("記事").Cells(4, "B").Replace What:="!", Replacement:=vbLf, LookAt:=xlPart
    Worksheets("記事").Cells(10, "B").Replace What:="!", Replacement:=vbLf, LookAt:=xlPart
    Open "C:\Users\kouhe\Desktop\a.txt" For Output As #1

    Do While Worksheets("記事").Cells(R, "B") <> ""
    Worksheets("記事").Cells(R, "B").Select
    
     Print #1, Replace(Worksheets("記事").Cells(R, "B"), vbLf, vbCrLf)
    R = R + 1
    Loop
  
    Close #1

End Sub

Sub 記事転記()
    Worksheets("記事").Cells(2, "B").Value = "　" & Worksheets("many").Cells(2, "A").Value
    Worksheets("記事").Cells(6, "B").Value = "　" & Worksheets("many").Cells(2, "C").Value
    Worksheets("記事").Cells(8, "B").Value = "　" & Worksheets("many").Cells(2, "D").Value
    Worksheets("記事").Cells(12, "B").Value = "　" & Worksheets("many").Cells(2, "F").Value
End Sub

Sub 文章校正1(ByVal Number As Integer)
    Dim R As Integer    '行番号
    Dim K As Integer
    R = 2
    K = 2
    Worksheets("Main").Activate
    Cells(2, "K").Select
    With Selection
     .Replace What:="!", Replacement:="", LookAt:=xlPart
      .Replace What:=vbLf, Replacement:="", LookAt:=xlPart
      .Replace What:="　", Replacement:="", LookAt:=xlPart

     End With
     
    Worksheets("記事").Cells(10, "B").Value = Worksheets("記事").Cells(10, "B").Value & "　" & Number & Worksheets("Main").Cells(2, "i").Value & vbLf
    Do While Worksheets("Main").Cells(R, "K") <> ""
    
    If Worksheets("記事").Cells(10, "B").Value <> "" Then
        Worksheets("記事").Cells(10, "B").Value = Worksheets("記事").Cells(10, "B").Value & "　　" & Worksheets("Main").Cells(R, "K").Value & vbLf
    End If
    
    If Worksheets("記事").Cells(10, "B").Value = "" Then
        
        Worksheets("記事").Cells(10, "B").Value = Worksheets("記事").Cells(10, "B").Value & "　　" & Worksheets("Main").Cells(R, "K").Value
    End If
    
    R = R + 1
    Loop
    Worksheets("記事").Cells(10, "B").Value = Worksheets("記事").Cells(10, "B").Value & vbLf
    
End Sub

Sub 文章校正2(ByVal Number As Integer)
    Dim R As Integer    '行番号
    Dim K As Integer
    R = 2
    K = 2
    Worksheets("Main").Activate
    Cells(2, "L").Select
    With Selection
     .Replace What:="!", Replacement:="", LookAt:=xlPart
      .Replace What:=vbLf, Replacement:="", LookAt:=xlPart
      .Replace What:="　", Replacement:="", LookAt:=xlPart

     End With
    Worksheets("記事").Cells(4, "B").Value = Worksheets("記事").Cells(4, "B").Value & "　" & Number & Worksheets("Main").Cells(2, "i").Value & vbLf
    Do While Worksheets("Main").Cells(R, "L") <> ""
    
    If Worksheets("記事").Cells(4, "B").Value <> "" Then
        Worksheets("記事").Cells(4, "B").Value = Worksheets("記事").Cells(4, "B").Value & "　　" & Worksheets("Main").Cells(R, "L").Value & vbLf
    End If
    
    If Worksheets("記事").Cells(4, "B").Value = "" Then
        
        Worksheets("記事").Cells(4, "B").Value = "　　" & Worksheets("Main").Cells(R, "L").Value
    End If
    
    R = R + 1
    Loop
    Worksheets("記事").Cells(4, "B").Value = Worksheets("記事").Cells(4, "B").Value & vbLf
    
End Sub



